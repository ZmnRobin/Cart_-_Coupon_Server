generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

enum DiscountType {
  FIXED
  PERCENTAGE
}

model Product {
  id               Int                  @id @default(autoincrement())
  sku              String               @unique
  priceCents       Int                  
  name             Strin
  cartItems        CartItem[]
  restrictions     ProductRestriction[]
}

model Cart {
  id                Int        @id @default(autoincrement())
  userId            String     @unique 
  appliedCouponCode String?   
  items             CartItem[]
}

model CartItem {
  id        Int     @id @default(autoincrement())
  cartId    Int
  productId Int
  quantity  Int
  cart      Cart    @relation(fields: [cartId], references: [id])
  product   Product @relation(fields: [productId], references: [id])

  @@unique([cartId, productId]) 
}

model Coupon {
  id                Int                  @id @default(autoincrement())
  code              String               @unique
  discountType      DiscountType
  discountValue     Decimal              
  maxDiscountCents  Int?                 
  autoApply         Boolean              @default(false)
  version           Int                  @default(0) 
  
  maxUses           Int?                 
  usesPerUser       Int?                 
  minCartItems      Int?                 
  minCartTotalCents Int?                 
  expiryDate        DateTime?
  
  currentUses       Int                  @default(0)

  restrictions      ProductRestriction[]
}

model ProductRestriction {
  id        Int     @id @default(autoincrement())
  couponId  Int
  productId Int
  coupon    Coupon  @relation(fields: [couponId], references: [id])
  product   Product @relation(fields: [productId], references: [id])
  @@unique([couponId, productId])
}
